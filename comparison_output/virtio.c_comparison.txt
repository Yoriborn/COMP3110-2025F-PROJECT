
Comparing 'C:\Users\Liv's Gaming PC\Documents\COMP3110-2025F-PROJECT\database\virtio_V1.c' and 'C:\Users\Liv's Gaming PC\Documents\COMP3110-2025F-PROJECT\database\virtio_V2.c'...

Line 1:
  File 1 -> #include "headers/virtio.h"
  File 2 -> #include "virtio.h"
--------------------------------------------------
Line 2:
  File 1 -> #include "../klib/headers/stdlib.h"
  File 2 -> #include "../../klib/stdlib.h"
--------------------------------------------------
Line 3:
  File 1 -> #include "../kernel/headers/kernel.h"
  File 2 -> #include "../../kernel/kernel.h"
--------------------------------------------------
Line 21:
  File 1 -> 
  File 2 -> struct virt_queue *virtq_init(unsigned port, unsigned index) {
--------------------------------------------------
Line 22:
  File 1 -> 
  File 2 -> // Allocate a region for the virtqueue
--------------------------------------------------
Line 23:
  File 1 -> struct virt_queue *virtq_init(unsigned port, unsigned index) {
  File 2 -> uint64_t virtq_paddr = (uint64_t) kalloc(align_up(sizeof(struct virt_queue), PAGE_SIZE) / PAGE_SIZE);
--------------------------------------------------
Line 24:
  File 1 -> // Allocate a region for the virtqueue
  File 2 -> if (!virtq_paddr) {
--------------------------------------------------
Line 25:
  File 1 -> uint64_t virtq_paddr = (uint64_t) kalloc(align_up(sizeof(struct virt_queue), PAGE_SIZE) / PAGE_SIZE);
  File 2 -> PANIC("virtio: out of memory");
--------------------------------------------------
Line 26:
  File 1 -> if (!virtq_paddr) {
  File 2 -> }
--------------------------------------------------
Line 27:
  File 1 -> PANIC("virtio: out of memory");
  File 2 -> struct virt_queue *vq = (struct virt_queue *) virtq_paddr;
--------------------------------------------------
Line 28:
  File 1 -> }
  File 2 -> vq->queue_index = index;
--------------------------------------------------
Line 29:
  File 1 -> struct virt_queue *vq = (struct virt_queue *) virtq_paddr;
  File 2 -> vq->used_index = (volatile uint16_t *) &vq->used.idx;
--------------------------------------------------
Line 30:
  File 1 -> vq->queue_index = index;
  File 2 -> 
--------------------------------------------------
Line 31:
  File 1 -> vq->used_index = (volatile uint16_t *) &vq->used.idx;
  File 2 -> // Select the queue writing its index
--------------------------------------------------
Line 32:
  File 1 -> 
  File 2 -> virtio_reg_write32(port, VIRTR_QUEUE_SEL_O, index);
--------------------------------------------------
Line 33:
  File 1 -> // Select the queue writing its index
  File 2 -> // Notify the device about the queue size
--------------------------------------------------
Line 34:
  File 1 -> virtio_reg_write32(port, VIRTR_QUEUE_SEL_O, index);
  File 2 -> virtio_reg_write32(port, VIRTR_QUEUE_NUM_O, VIRTQ_ENTRY_NUM);
--------------------------------------------------
Line 35:
  File 1 -> // Notify the device about the queue size
  File 2 -> // Notify the device about the used alignment
--------------------------------------------------
Line 36:
  File 1 -> virtio_reg_write32(port, VIRTR_QUEUE_NUM_O, VIRTQ_ENTRY_NUM);
  File 2 -> virtio_reg_write32(port, VIRTR_QUEUE_ALIGN_O, 0);
--------------------------------------------------
Line 37:
  File 1 -> // Notify the device about the used alignment
  File 2 -> // Write the physical number of the first page of the queue
--------------------------------------------------
Line 38:
  File 1 -> virtio_reg_write32(port, VIRTR_QUEUE_ALIGN_O, 0);
  File 2 -> virtio_reg_write32(port, VIRTR_QUEUE_PFN_O, virtq_paddr);
--------------------------------------------------
Line 39:
  File 1 -> // Write the physical number of the first page of the queue
  File 2 -> return vq;
--------------------------------------------------
Line 40:
  File 1 -> virtio_reg_write32(port, VIRTR_QUEUE_PFN_O, virtq_paddr);
  File 2 -> }
--------------------------------------------------
Line 41:
  File 1 -> return vq;
  File 2 -> 
--------------------------------------------------
Line 42:
  File 1 -> }
  File 2 -> void virtq_kick(unsigned port, struct virt_queue *vq, int desc_index) {
--------------------------------------------------
Line 43:
  File 1 -> 
  File 2 -> vq->avail.ring[vq->avail.idx % VIRTQ_ENTRY_NUM] = desc_index;
--------------------------------------------------
Line 44:
  File 1 -> void virtq_kick(unsigned port, struct virt_queue *vq, int desc_index) {
  File 2 -> vq->avail.idx++;
--------------------------------------------------
Line 45:
  File 1 -> vq->avail.ring[vq->avail.idx % VIRTQ_ENTRY_NUM] = desc_index;
  File 2 -> __sync_synchronize();
--------------------------------------------------
Line 46:
  File 1 -> vq->avail.idx++;
  File 2 -> virtio_reg_write32(port, VIRTR_QUEUE_NOTIFY_O, vq->queue_index);
--------------------------------------------------
Line 47:
  File 1 -> __sync_synchronize();
  File 2 -> vq->last_used_index++;
--------------------------------------------------
Line 48:
  File 1 -> virtio_reg_write32(port, VIRTR_QUEUE_NOTIFY_O, vq->queue_index);
  File 2 -> }
--------------------------------------------------
Line 49:
  File 1 -> vq->last_used_index++;
  File 2 -> 
--------------------------------------------------
Line 50:
  File 1 -> }
  File 2 -> int virtq_is_busy(struct virt_queue *vq) {
--------------------------------------------------
Line 51:
  File 1 -> 
  File 2 -> return vq->last_used_index != *vq->used_index;
--------------------------------------------------
Line 52:
  File 1 -> int virtq_is_busy(struct virt_queue *vq) {
  File 2 -> }
--------------------------------------------------
Line 53:
  File 1 -> return vq->last_used_index != *vq->used_index;
  File 2 -> 
--------------------------------------------------
Line 54:
  File 1 -> }
  File 2 -> 
--------------------------------------------------
Line 55:
  File 1 -> 
  File 2 -> <no line>
--------------------------------------------------
Line 56:
  File 1 -> 
  File 2 -> <no line>
--------------------------------------------------

Found 39 difference(s).
